@startuml
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml

title Conatainer diagram for Smart Home

Person(user, "Пользователь", "Пользователь приложения", $type="user")

System_Boundary(system, "Smart Home") {
    Container(gateway, "API Gateway", "nginx", "Маршрутизация запросов к микросервисам")
    Container(frontend, "Веб приложение", "react", "Веб интерфейс для взаимодействия пользователей с приложением")
    Container(users, "Пользователи", "python")
    Container(devices, "Управление устройствами", "python")
    Container(scenaries, "Управление сценариями", "python")
    Container(telemetry, "Телеметрия", "python")

    ContainerDb(db_users, "База данных", "PostgreSQL")
    ContainerDb(db_devices, "База данных", "PostgreSQL")
    ContainerDb(db_scenaries, "База данных", "PostgreSQL")
    ContainerDb(db_telemetry, "База данных", "PostgreSQL")
}

System_Ext(device, "Устройство", "Управляет установленной в доме системой")
System_Ext(sensor, "Датчик", "Предоставляет информацию о состоянии")

Rel(user, frontend, "Uses", "HTTPS")
Rel(frontend, gateway, "Uses", "HTTPS")
Rel(gateway, users, "Uses", "HTTP")
Rel(gateway, devices, "Uses", "HTTP")
Rel(gateway, scenaries, "Uses", "HTTP")
Rel(gateway, telemetry, "Uses", "HTTP")
Rel_L(devices, telemetry, "Uses", "HTTP")
Rel(users, db_users, "Read and write", "TCP\IP")
Rel(users, devices, "Uses", "HTTP")
Rel_L(devices, scenaries, "Uses", "HTTP")
Rel(devices, db_devices, "Read and write", "TCP\IP")
Rel(scenaries, db_scenaries, "Read and write", "TCP\IP")
Rel(telemetry, db_telemetry, "Read and write", "TCP\IP")
Rel(devices, device, "Uses", "HTTP\HTTPS")
Rel(telemetry, sensor, "Uses", "HTTP\HTTPS")

SHOW_LEGEND()
@enduml